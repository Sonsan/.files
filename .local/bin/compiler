#!/usr/bin/env sh

file=$(readlink -f "$1")
dir=$(dirname "$file")
base="${file%.*}"

cd "$dir" || exit

texcompile() {
    command="pdflatex"
    cmdout=$($command --halt-on-error --output-directory="$dir" "$base")
    if [ "$(echo $cmdout | grep 'Fatal error')" != "" ] ; then notify-send "❌ compile failed" && exit ; fi
    $command --output-directory="$dir" "$base" &&
    $command --output-directory="$dir" "$base" &&
    notify-send "✅ compiled"
}

case "$file" in
    *\.tex) texcompile "$file" ;;
    *\config.h) sudo make install ;;
    *) notify-send "❌ cannot compile" "$file" ;;
esac
